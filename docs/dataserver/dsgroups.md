# Ресурс "Группы рядов" (dsgroups)

**Назначение:**

Ресурс "Группы рядов" для объединения рядов данных по какому то набору признаков.

Каждая Группа рядов может быть привязана к другой Группе рядов через поле `pdsgid`

Каждая Группа рядов может быть привязана к контексту Источника, который был использован при парсинге данных, через поле `ctxid`

Каждая Группа рядов имеет массив key-value значений, которое называется метаданные (`metadata`)

**Запросы**

## 6.1. Получить список групп рядов

**Назначение:** Получить информацию по интересующим группам рядов.

**Запрос** `/api/v2/dsgroups/list`

**Тип запроса:** POST

**Возможные параметры:** 
| **параметр**  | **тип**     | **описание**                                                                      |
|---------------|-------------|-----------------------------------------------------------------------------------|
| `flag`        |            | список параметров выдачи. Возможные значения:                        |
| `-dataseries` | `bool`      | добавляет в выдачу идентификаторы рядов Группы |

**Тело запроса:**

```json

{
  "dsgid": [
    "5cfec624-e4c3-11e7-80c1-9a214cf093ae",
    "5cfec8cc-e4c3-11e7-80c1-9a214cf093ae"
  ],
  "dsid": [
    "5cfec624-e4c3-11e7-80c1-9a214cf093ae",
    "5cfec8cc-e4c3-11e7-80c1-9a214cf093ae"
  ],
  "pdsgid": [
    "5cfec624-e4c3-11e7-80c1-9a214cf093ae",
    "5cfec8cc-e4c3-11e7-80c1-9a214cf093ae"
  ],
  "sid": [
    "1234-000079-0001",
    "1234-000079-0000"
  ],
  "ctxid": [
    "5cfec624-e4c3-11e7-80c1-9a214cf093ae",
    "5cfec8cc-e4c3-11e7-80c1-9a214cf093ae"
  ],
  "metadata": {
    "key1": "value1",
    "key2": "value2"
  }
}
```

**Поля запроса:**

| **имя поля**  | **тип**     | **описание**                                                                      |
|---------------|-------------|-----------------------------------------------------------------------------------|
| `page`        | `integer`   | текущая страница для отображения                                                  |
| `pagesize`    | `integer`   | кол-во элементов на странице для отображения. По умолчанию pagesize = 100         |
| `updatedfrom` | `timestamp` | нижняя граница штампа времени `updated`                                           |
| `updatedto`   | `timestamp` | верхняя граница штампа времени `updated`                                          |
| `dsid`        | `[]uuid`    | массив уникальных идентификаторов Рядов, которые привязаны к Группам рядов        |
| `dsgid`       | `[]uuid`    | массив уникальных идентификаторов Групп рядов, по которым нужно выдать информацию |
| `pdsgid`      | `[]uuid`    | массив уникальных идентификаторов Групп рядов, к которым привязаны искомые группы |
| `ctxid`       | `[]uuid`    | массив уникальных идентификаторов Контекстов, к которым привязаны искомые группы |
| `sid`         | `[]string`  | массив идентификаторов источников                                                 |
| `metadata`    | `object`    | список метаданных, которые идентифицируют группу                                  |

**Ответ:**

```json
{
  "meta": {},
  "response": {
    "dsgroups": {
      "info": {
        "page": 3,
        "pagecount": 3,
        "pagesize": 1000,
        "total": 3003
      },
      "items": [
        {
          "dsgid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
          "name": "Группа рядов для данных из кода КН-01",
          "pdsgid": null,
          "ctxid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
          "sid": "1234-000096-0000",
          "metadata": {
            "key1": "value1",
            "key2": "value2"
          },
          "dataseries": {
            "count": 3,
            "items": [
              {
                "created": 1745497026,
                "dsid": "09ff629e-2106-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1755173702,
                "mid": null,
                "updated": 1745497026
              },
              {
                "created": 1747397536,
                "dsid": "01d73c98-324f-11f0-b55b-02420a0001bb",
                "lastData": null,
                "last_insert": 1755173571,
                "mid": null,
                "updated": 1747397536
              },
              {
                "created": 1745496754,
                "dsid": "674c4880-2105-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1747246359,
                "mid": null,
                "updated": 1745496754
              }
            ]
          },
          "created": 12513515,
          "updated": 14215312
        },
        {
          "dsgid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
          "name": "Группа рядов для данных из CommonXML",
          "pdsgid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
          "ctxid": null,
          "sid": "1234-000196-0000",
          "metadata": {
            "key1": "value1",
            "key2": "value2"
          },
          "dataseries": {
            "count": 3,
            "items": [
              {
                "created": 1745497026,
                "dsid": "09ff629e-2106-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1755173702,
                "mid": null,
                "updated": 1745497026
              },
              {
                "created": 1747397536,
                "dsid": "01d73c98-324f-11f0-b55b-02420a0001bb",
                "lastData": null,
                "last_insert": 1755173571,
                "mid": null,
                "updated": 1747397536
              },
              {
                "created": 1745496754,
                "dsid": "674c4880-2105-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1747246359,
                "mid": null,
                "updated": 1745496754
              }
            ]
          },
          "created": 12513515,
          "updated": 14215312
        }
      ]
    }
  }
}
```

**Возможные поля ответа:**

| **имя поля** | **тип**  | **описание**                                                        |
|--------------|----------|---------------------------------------------------------------------|
| `page`       | `string` | текущий номер страницы (дублирует параметр запроса)                 |
| `pagesize`   | `string` | сколько элеметнов выдавать на странице (дублирует параметр запроса) |
| `dsgid`      | `uuid`   | уникальный идентификатор Группы рядов                               |
| `name`       | `string` | наименование Группы рядов                                           |
| `pdsgid`     | `uuid`   | идентификатор Группы рядов, к которой привязана Группа рядов        |
| `ctxid`      | `uuid`   | идентификатор Контекста Источника, к которой привязана Группа рядов |
| `sid`        | `string` | уникальный идентификатор источника к которому привязана группа      |
| `metadata`   | `object` | список метаданных группы рядов                                      |
| `dataseries` | `[]json` | массив рядов Группы (выдается только если установлен флаг dataseries) |
| `created`    | `int64`  | unixtime время создания Группы рядов                                |
| `updated`    | `int64`  | unixtime время изменения Группы рядов                               |

## 6.2. Получить запись Группы рядов по идентификатору

**Назначение:** для получения информации по Групп рядо по идентификатору.

**Запрос** `/api/v2/dsgroups/DSGID`

**Тип запроса:** GET

**Параметры запроса:**
* `dataseries=true` - в ответ будут добавлена информация о рядах Группы


**Пример:**  `/api/v2/dsgroups/dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "dsgroups": [
      {
        "dsgid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
        "name": "Группа рядов для данных из кода КН-01",
        "pdsgid": null,
        "ctxid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
        "sid": "1234-000196-0000",
        "metadata": {
          "key1": "value1",
          "key2": "value2"
        },
          "dataseries": {
            "count": 3,
            "items": [
              {
                "created": 1745497026,
                "dsid": "09ff629e-2106-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1755173702,
                "mid": null,
                "updated": 1745497026
              },
              {
                "created": 1747397536,
                "dsid": "01d73c98-324f-11f0-b55b-02420a0001bb",
                "lastData": null,
                "last_insert": 1755173571,
                "mid": null,
                "updated": 1747397536
              },
              {
                "created": 1745496754,
                "dsid": "674c4880-2105-11f0-b81e-02420a0001f8",
                "lastData": null,
                "last_insert": 1747246359,
                "mid": null,
                "updated": 1745496754
              }
            ]
          },
        "created": 12513515,
        "updated": 14215312
      }
    ]
  }
}
```

**Возможные поля ответа :**

| **имя поля** | **тип**  | **описание**                                                   |
|--------------|----------|----------------------------------------------------------------|
| `dsgid`      | `uuid`   | уникальный идентификатор Группы рядов                          |
| `name`       | `string` | наименование Группы рядов                                      |
| `pdsgid`     | `uuid`   | идентификатор Группы рядов, к которой привязана Группа рядов   |
| `ctxid`      | `uuid`   | идентификатор Контекста Источника, к которой привязана Группа рядов |
| `sid`        | `string` | уникальный идентификатор источника к которому привязана группа |
| `metadata`   | `object` | список метаданных группы рядов                                 |
| `dataseries` | `[]json` | массив рядов Группы (выдается только если установлен флаг dataseries) |
| `created`    | `int64`  | unixtime время создания Группы рядов                           |
| `updated`    | `int64`  | unixtime время изменения Группы рядов                          |

## 6.3. Создать новую запись Группы рядов

**Назначение:** для создания новой записи Группы рядов.

При создании новой записи необходимо указать уникальный идентификатор источника, к которому данная запись будет
привязана, и список метаданных Группы ряда

**Запрос** `/api/v2/dsgroups/new`

**Тип запроса:** POST

**Пример:**  `/api/v2/dsgroups/new`

**Передаваемые данные:**

```json

{
  "dsgid": "74960958-de03-4095-9f5e-35f6dc016f45",
  "name": "Группа рядов для данных из кода КН-01",
  "pdsgid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
  "ctxid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
  "sid": "1234-000196-0000",
  "metadata": {
    "key1": "value1",
    "key2": "value2"
  },
  "dataseries": [
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
  ]
}
```

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "dsgroups": {
      "dsgid": "74960958-de03-4095-9f5e-35f6dc016f45"
    }
  }
}
```

**Обязательный параметр:**

| **имя поля** | **тип**  | **описание**                       |
|--------------|----------|------------------------------------|
| `sid`        | `string` | уникальный идентификатор источника |

**Необязательный параметр:**

| **имя поля** | **тип**  | **описание**                                                     |
|--------------|----------|------------------------------------------------------------------|
| `name`       | `string` | наименование Группы рядов                                        |
| `dsgid`      | `uuid`   | идентификатор Группы рядов                                       |
| `pdsgid`     | `uuid`   | идентификатор Группы рядов, к которой привязана эта Группа рядов |
| `ctxid`      | `uuid`   | идентификатор Контекста Источника, к которой привязана Группа рядов |
| `metadata`   | `object` | список метаданных, которые идентифицируют группу                 |
| `dataseries` | `[]uuid` | список рядов для включения в Группу              |

**Поля ответа :**

| **имя поля** | **тип** | **описание**                           |
|--------------|---------|----------------------------------------|
| `dsgid`      | `uuid`  | уникальный идентификатор Группы рядов. |

## 6.4. Удалить запись Группы рядов

**Назначение:** для удаления записи Группы рядов по идентификатору

**Запрос** `/api/v2/dsgroups/DSG_ID/rem`

**Тип запроса:** POST

**Пример:**  `/api/v2/dsgroups/dea50f0c-f55f-4063-9f17-e45ae8c03bce/rem`

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}
```

## 6.5. Обновление записи Группы рядов

**Назначение:** Изменяет поля Группы рядов.

**Запрос** `/api/v2/dsgroups/DSG_ID/update`

**Тип запроса:** POST

**Пример:**  `/api/v2/dsgroups/bbbb1232-ed42-11ce-bacd-00aa00000325/update`

Передаваемые параметры:

```json

{
  "name": "Группа рядов для данных из кода КН-01",
  "metadata": {
    "key1": "value1",
    "key2": "value2"
  }
}
```

**Необязательные поля:**

| **имя поля** | **тип**  | **описание**                                     |
|--------------|----------|--------------------------------------------------|
| `name`       | `string` | наименование Группы рядов                        |
| `metadata`   | `object` | список метаданных, которые идентифицируют группу |

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}
```

При обновлении поля `pdsgid`, `ctxid` и `sid` не могут быть изменены


## 6.6. Добавить ряды в Группу

**Назначение:** Добавляет ряды в Группу.

**Запрос** `/api/v2/dsgroups/DSG_ID/include`

**Тип запроса:** POST

**Пример:**  `/api/v2/dsgroups/bbbb1232-ed42-11ce-bacd-00aa00000325/include`

Передаваемые параметры:

```json

{
  "dataseries": [
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
  ]
}
```

**Необязательные поля:**

| **имя поля** | **тип**  | **описание**                                     |
|--------------|----------|--------------------------------------------------|
| `dataseries` | `[]uuid` | список рядов для включения в Группу              |

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}
```

## 6.7. Исключить ряды из Группы

**Назначение:** Удаляет ряды из Группы.

**Запрос** `/api/v2/dsgroups/DSG_ID/exclude`

**Тип запроса:** POST

**Пример:**  `/api/v2/dsgroups/bbbb1232-ed42-11ce-bacd-00aa00000325/exclude`

Передаваемые параметры:

```json

{
  "dataseries": [
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce",
    "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
  ]
}
```

**Необязательные поля:**

| **имя поля** | **тип**  | **описание**                                     |
|--------------|----------|--------------------------------------------------|
| `dataseries` | `[]uuid` | список рядов для исключения из Группы              |

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}
```

