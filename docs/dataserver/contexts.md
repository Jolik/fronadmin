# Ресурс "Контексты Источника" (contexts)

Контексты позволяют "прикрепить" к Источникам дополнительные данные, зависимые от контекста.

Например, индексы станций/постов, их наименование, идентификаторы оборудования и т.д.

Таким образом, к одному Источнику возможно "прикрепление" различных Контекстов, которые будут использованы для обработки данных. 
Например, у одному Источнику могут быть "прикреплены" контекст метеорологической станции со своим индексом станции и контекст 
гидрологического поста со своим индексом.

**Запросы**

## 1. Список Контекстов Источников

**Назначение:** для получения списка Контекстов Источников

**Запрос:** `/api/v2/sources/contexts/list`

**Тип запроса:** POST

**Тело запроса:**

```json

{
  "ctxtid": [
    "CTX_TYPE_METPLACE",
    "CTX_TYPE_EQU"
  ],
  "ctxid": [
    "1631cd00-d431-4152-8b0e-2887e1200747",
    "1631cd00-d431-4152-8b0e-2887e1200747"
  ],
  "sid": [
    "0001-012345-0000",
    "0001-012345-0002"
  ],
  "index": [
    "12345",
    "index123"
  ],
  "crid": [
    "1631cd00-d431-4152-8b0e-2887e1200747",
    "1631cd00-d431-4152-8b0e-2887e1200747"
  ]
}

```

**Поля тела запроса:**

| **имя поля** | **тип**    | **описание**                                                              |
|--------------|------------|---------------------------------------------------------------------------|
| `ctxtid`     | `[]string` | идентификатор типа Контекста                                              |
| `ctxid`      | `[]uuid`   | идентификаторы Контекста                                                   |
| `sid`        | `[]string` | идентификатор Источников                                                  |
| `index`      | `[]string` | индексы Источников                                                        |
| `crid`       | `[]uuid`   | идентификаторы Контекста                                                   |
| `page`       |            | текущая страница для отображения                                          | 
| `pagesize`   |            | кол-во элементов на странице для отображения. По умолчанию pagesize = 100 |
| `order`      | `[]string` | устанавливает сортировку выдачи списка. Возможные значения в массиве:     | 
| `-sid`       | `opt`      | сортировка по ID источника, к которому принадлежит привязка               | 
| `-index`     | `opt`      | сортировка по индексу                                                     |
| `-created`   | `opt`      | сортировка по времени создания                                            | 
| `-updated`   | `opt`      | сортировка по времени обновления                                          | 
| `orderDir`   | `string`   | устанавливает направление сортировки выдачи списка. `asc` или `desc`      | 

**Обязательные параметры**: нет

**Пример:**
* `/api/v2/sources/contexts/list`

**Ответ:**

```json
{
  "meta": {},
  "response": {
    "info": {
      "page": 3,
      "pagecount": 3,
      "pagesize": 1000,
      "total": 3004
    },
    "contexts": [
      {
        "ctxid": "1631cd00-d431-4152-8b0e-2887e1200747",
        "ctxtid": "CTX_TYPE_METPLACE",
        "sid": "0001-012345-0000",
        "index": "12345",
        "data" : {}
      },
      {
        "ctxid": "1631cd00-d431-4152-8b0e-2887e1200747",
        "ctxtid": "CTX_TYPE_METPLACE",
        "sid": "0001-012345-0000",
        "index": "12345",
        "data" : {}
      }
    ]
  }
}

``` 

**Обязательные поля ответа:**

| **имя поля** | **тип**      | **описание**                        |
|--------------|--------------|-------------------------------------|
| `ctxid`      | `uuid`       | идентификатор Контекста             |
| `ctxtid`     | `string[32]` | идентификатор типа Контекста        |
| `index`      | `string[64]` | индекс Источника в данном Контексте |
| `data`       | `json`       | данные Контекста                    |


## 2. Информаиция по указанному Контексту

**Назначение:**: для получения информации по указанному Контексту

**Запрос:** `/api/v2/sources/contexts/CONTEXT_ID`

где
* `CONTEXT_ID` - уникальный идентификатор Контексты

**Пример:**
* `/api/v2/sources/contexts/1631cd00-d431-4152-8b0e-2887e1200747`

**Ответ:**

```json

{  
  "meta": {},
  "response": {
    "context": 
      {
        "ctxid": "1631cd00-d431-4152-8b0e-2887e1200747",
        "ctxtid": "CTX_TYPE_METPLACE",
        "sid": "0001-012345-0000",
        "index": "12345",
        "data" : {}
      }
  }
}

```  

## 3. Добавить Контекст

**Назначение:** для создания нового Контекста 

**Запрос:** `/api/v2/sources/contexts/new`

**Тип запроса:** POST

**Передаваемые данные:**

```json
      {
        "ctxid": "1631cd00-d431-4152-8b0e-2887e1200747",
        "ctxtid": "CTX_TYPE_METPLACE",
        "sid": "0001-012345-0000",
        "index": "12345",
        "data" : {}
      }
```

**Обязательные поля:**

| **имя поля** | **тип**      | **описание**                 |
|--------------|--------------|------------------------------|
| `ctxtid`     | `string[32]` | идентификатор типа Контекста |
| `sid`        | `string[16]` | идентификатор Источника      |
| `index`      | `string[32]` | индекс Источника в Контексте |

**Необязательные поля:**

| **имя поля** | **тип** | **описание**                       |
|--------------|---------|------------------------------------|
| `ctxid`      | `uuid`  | уникальный идентификатор Контекста |
| `data`       | `json`  | данные Контекста                   |

**Ответ:**

```json
{
  "meta": {},
  "response": {}
}

```

## 4. Обновить Контекст

**Назначение:** для обновления полей Контекста.

Обновляются указанные в запросе поля. 

Обновить можно только поле `data`

**Запрос:** `/api/v2/sources/contexts/CONTEXT_ID/update`

**Тип запроса:** POST

**Пример:** `/api/v2/sources/contexts/1631cd00-d431-4152-8b0e-2887e1200747/update`

**Передаваемые данные:**

```json
{
  "data": {}     
}

```

**Возможные поля Контексты:**

| **имя поля** | **тип** | **описание**     |
|--------------|---------|------------------|
| `data`       | `json`  | данные Контекста |


**Ответ:**

```json

{
  "meta": {},
  "response": {}
}

```


## 5. Удалить Контекст

**Назначение:** для удаления Контекста

**Запрос:** `/api/v2/sources/contexts/CONTEXT_ID/remove`

где
* `CONTEXT_ID` - уникальный идентификатор Контекста

**Тип запроса:** POST

**Пример:** `/api/v2/sources/contexts/1631cd00-d431-4152-8b0e-2887e1200747/remove`

**Ответ:**

```json

{
  "meta": {},
  "response": {}
}
```


## Описание контекстов

### Контекст CTX_TYPE_METEOPLACE

```json

  {
    "ctxid": "1631cd00-d431-4152-8b0e-2887e1200747",
    "ctxtid": "CTX_TYPE_METEOPLACE",
    "sid": "RU02-012345-0000",
    "index": "12345",
    "data" : {
      "params": {
        "meteoRange": 900,
        "timeShift": 900
      }
    }
  }
```

**Возможные поля Контексты:**

| **имя поля** | **тип** | **описание**     |
|--------------|---------|------------------|
| `index`       | `string`  | Метеорологический индекс станции |
| `meteoRange`       | `integer`  | Граница метеорологических суток в минутах от полуночи UTC |
| `timeShift`       | `integer`  | Временной сдвиг в минутах |

