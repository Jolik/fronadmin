# 2. Ресурс "Задания" (tasks)

**Запросы**

## 2.1. Список Заданий

**Назначение:** для получения списка Заданий для комплектования 

**Запрос:** `/api/v2/tasks/list`

**Тип запроса:** POST

**Тело запроса:**

```json

{
  "tid": [
    "1631cd00-d431-4152-8b0e-2887e1200747",
    "1631cd00-d431-4152-8b0e-2887e1200747"
  ],
  "compid": [
    "1631cd00-d431-4152-8b0e-2887e1200747",
    "1631cd00-d431-4152-8b0e-2887e1200747"
  ],
  "depid": [
    "1631cd00-d431-4152-8b0e-2887e1200747",
    "1631cd00-d431-4152-8b0e-2887e1200747"
  ]
}

```

**Поля тела запроса:**

| **имя поля** | **тип**  | **описание**                            |
|--------------|----------|-----------------------------------------|
| `tid`        | `[]string` | массив идентификаторов Заданий        |
| `compid`     | `[]string` | массив идентификаторов Компаний       |
| `depid`      | `[]string` | массив идентификаторов Департаментов  |

**Обязательные параметры**: нет

**Пример:**
* `/api/v2/tasks/list`

**Ответ:**

```json
{
  "response": {
    "tasks": [
      {
        "tid": "5d159669-0cb0-11ec-a8d8-00ff1185687c",
        "def": "",
        "module": "SummarySynop",
        "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
        "depid": "4cf0dbf0-820b-4e05-a819-d6d1ec5652f0",
        "name": "Комплектование TTAA01 CCCC (КН-01) 1",
        "enabled": false,
        "settings": {
          "Custom": {},
          "ExcludeWeek": [0, 0, 0, 0, 0, 0, 0],
          "Time": "03:00/+25 09:00/* 15:00/* 21:00/*",
          "Header": "TTAA01 CC13"
        }
      }, 
      {
        "tid": "48332ad5-55c1-4e64-b2ea-e99d0c78f900",
        "def": "",
        "module": "SummaryHydra",
        "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
        "depid": "4cf0dbf0-820b-4e05-a819-d6d1ec5652f0",
        "name": "Комплектование TTAA15 CCCC (КН-15)",
        "enabled": false,
        "settings": {
          "LatePeriod": 120,
          "MonthDays": "1-32",
          "Local": true,
          "CheckLate": true,
          "Custom": {
            "DaysAgo": 5
          },
          "LateEvery": 60,
          "ExcludeWeek": [0, 0, 0, 0, 0, 0, 0],
          "Time": "08:00/+90 20:00/*",
          "Header": "TTAA15 CCCC"
        }
      }
    ]
  },
  "meta": {
    "rid": "205f137d-9d3b-4894-a725-50a71caae4b4",
    "time": "0ms",
    "code": 200
  }
}
``` 

**Обязательные поля ответа:**

| **имя поля** | **тип**  | **описание**                            |
|--------------|----------|-----------------------------------------|
| `tid`        | `string` | идентификатор Задания                   |
| `name`       | `string` | наименование Задания                    |
| `module`     | `string` | название модуля комплектования          |
| `enable`     | `bool`   | разрешение работы Задания               |
| `settings`   | `json`   | настройки Задания                       |


**Поля settings:**

| **имя поля** | **тип**        | **описание**                                    |
|--------------|----------------|-------------------------------------------------|
| `Time`       | `string`       | строка расписания Задания                       |
| `Local`      | `boolean`      | индикатор типа времени Задания                  |
| `MonthDays`  | `string`       | дни месяца, когда Задание активно               |
| `ExcludeWeek`| `array of int` | дни недели, когда Задание не активно            |
| `CheckLate`  | `boolean`      | Проверка опоздавших (доукомплектование)         |
| `LatePeriod` | `integer`      | Продолжительность проверки опоздавших от срока  |
| `LateEvery`  | `integer`      | Период проверки опоздавших                      |
| `Custom`     | `json`         | Дополнительные настройки (зависят от module)    |


## 2.2. Информация по указанному Заданию

**Назначение:**: для получения информации по указанному Заданию

**Запрос:** `/api/v2/tasks/TASK_ID`

где
* `TASK_ID` - уникальный идентификатор Задания

**Пример:**
* `/api/v2/tasks/1631cd00-d431-4152-8b0e-2887e1200747`

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "task": {
      "tid": "48332ad5-55c1-4e64-b2ea-e99d0c78f900",
      "def": "",
      "module": "SummaryHydra",
      "compid": "85697f9f-b80d-4668-8ed2-2f70ed825eee",
      "depid": "4cf0dbf0-820b-4e05-a819-d6d1ec5652f0",
      "name": "Комплектование TTAA15 CCCC (КН-15)",
      "enabled": false,
      "settings": {
          "LatePeriod": 120,
          "MonthDays": "1-32",
          "Local": true,
          "CheckLate": true,
          "Custom": {
              "DaysAgo": 5
          },
          "LateEvery": 60,
          "ExcludeWeek": [0,0,0,0,0,0,0],
          "Time": "08:00/+90 20:00/*",
          "Header": "TTAA15 CCCC"
      }
    }
  }
}

```  

## 2.3. Добавить Задание

**Назначение:** для создания нового Задания

**Запрос:** `/api/v2/tasks/new`

**Тип запроса:** POST

**Передаваемые данные:**

```json
{
  "tid": "1631cd00-d431-4152-8b0e-2887e1200747",
  "name": "Комплектование TTAA01 CCCC",
  "def": "Это  тестовое комплектование",
  "module": "SummarySynop",  
  "enabled": true,
  "settings": {
    "Header": "TTAA01 CCCC",
    "LatePeriod": 120,
    "MonthDays": "1-32",
    "Local": false,
    "CheckLate": true,
    "Custom": {
      "CalcPoint_AirTempMin": "06",
      "CalcPoint_AirTempMax": "18",
      "DataPercent": 75,
    },
    "LateEvery": 60,
    "ExcludeWeek": [0,0,0,0,0,0,0],
    "Time": "00:00/+15 03:00/* 06:00/* 09:00/* 12:00/* 15:00/* 18:00/* 21:00/*"
  }
}
```

**Обязательные поля:**

| **имя поля** | **тип**  | **описание**                      |
|--------------|----------|-----------------------------------|
| `module`     | `string` | тип модуля комплектования         |

**Необязательные поля:**

| **имя поля** | **тип**  | **описание**                                  |
|--------------|----------|-----------------------------------------------|
| `tid`        | `string` | уникальный идентификатор Задания              |
| `enabled`    | `boolean`| разрешение работы Задания                     |
| `settings`   | `json`   | настройки комплектования                      |

**Ответ:**

```json
{
  "meta": {},
  "response": {
    "tid": "1631cd00-d431-4152-8b0e-2887e1200747"
  }  
}
```

## 2.4. Обновить Задание

**Назначение:** для обновления полей Задания.

- Обновляются указанные в запросе поля
- Набор полей тот же как и для создания /tasks/new за исключением полей tid и module
- Поле module обновить нельзя
- Поле settings обновляется целиком


**Запрос:** `/api/v2/tasks/TASK_ID/update`

**Тип запроса:** POST

**Пример:** `/api/v2/tasks/1631cd00-d431-4152-8b0e-2887e1200747/update`

**Передаваемые данные:**

```json
{
  "name": "Комплектование TTAA01 CCCC",
  "def": "Это  тестовое комплектование",    
  "enabled": true,
  "settings": {
    "Header": "TTAA01 CCCC",
    "LatePeriod": 120,
    "MonthDays": "1-32",
    "Local": false,
    "CheckLate": true,
    "Custom": {
      "CalcPoint_AirTempMin": "06",
      "CalcPoint_AirTempMax": "18",
      "DataPercent": 75,
    },
    "LateEvery": 60,
    "ExcludeWeek": [0,0,0,0,0,0,0],
    "Time": "00:00/+15 03:00/* 06:00/* 09:00/* 12:00/* 15:00/* 18:00/* 21:00/*"
  }
```

**Ответ:**

```json
{
  "meta": {},
  "response": {}
}
```


## 2.5. Удалить Задание

**Назначение:** для удаления Задания

**Запрос:** `/api/v2/tasks/TASK_ID/remove`

где
* `TASK_ID` - уникальный идентификатор Задания

**Тип запроса:** POST

**Пример:** `/api/v2/tasks/1631cd00-d431-4152-8b0e-2887e1200747/remove`

**Ответ:**

```json
{
  "meta": {},
  "response": {}
}
```



## 2.6. Получить список возможных типов Заданий

**Назначение:** для использования в запросах создания Заданий

**Запрос:** `/api/v2/tasks/types`

**Тип запроса:** GET

**Ответ:**

```json
{
  "meta": {}
  "response": {
    "types": [{
        "name": "SummarySynop",
        "caption": "КН-01 (SYNOP)"
      }, {
        "name": "SummarySea",
        "caption": "КН-02 (SEA)"
      }, {
        "name": "SummaryRHOB",
        "caption": "КН-13 (РХОБ)"
      }, {
        "name": "SummaryHydra",
        "caption": "КН-15 (ВОДА)"
      }
    ]
  }
}
```