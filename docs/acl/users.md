# Ресурс "Пользователи" (users)

Ресурс содержит список **Пользователей** зарегистрированных в системе.

Каждая запись имеет следующие поля:

* `usid` - уникальный идентификатор записи о Пользователи
* `compid` - идентификатор организации, к которой относится Пользователь
* `gid` - идентификатор группы Пользователя
* `name` - наименование Пользователи (никнейм)
* `email` - почта Пользователя
* `country` - страна Пользователя
* `org` - организация Пользователя (не compid!)

### Формат поля `data`:

```json
{
  "data": {
    "def": "Описание пользователя"
  }
}
```

### Формат поля `body`:

```json
{
  "body": {
    "roles": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "datasets": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "levels": [
      "b0e3e102-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e103-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e104-8bf5-11ec-88f9-02420a000dc5"
    ]
  }
}
```

**Поля "body":**

| **имя поля** | **тип**  | **описание**                                             |
|--------------|----------|----------------------------------------------------------|
| `roles`      | `[]uuid` | массив ролей присвоенных Пользователю                    |
| `levels`     | `[]uuid` | массив уровней доступа к данным присвоенных Пользователю |
| `datasets`   | `[]uuid` | массив датасетов доступных  Пользователю                 |

**Запросы**

## 1. Список Пользователей

**Назначение:** для получения списка зарегистрированных в системе Пользователей.

**Запрос** `/api/v1/users/list`

**Тип запроса:** POST

**Параметры**: нет

**Тело запроса:**

```json
{
  "page": 1,
  "pagesize": 100,
  "usid": [
    "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
    "6016ebf8-81a3-11e7-bb31-be2e44b06b35"
  ],
  "compid": [
    "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
    "6016ebf8-81a3-11e7-bb31-be2e44b06b35"
  ],
  "gid": [
    "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
    "6016ebf8-81a3-11e7-bb31-be2e44b06b35"
  ],
  "email": [
    "demo@example.com",
    "demo1@example.com"
  ],
  "country": [
    "Russia",
    "USA"
  ],
  "org": [
    "MeteoContext",
    "Roshydromet"
  ],
  "updateFrom": 46346364,
  "updateTo": 46346364,
  "searchStr": "bla-bla-bla",
  "search": [
    "name"
  ],
  "order": [
    "gid"
  ],
  "orderDir": "asc",
  "flag": [
    "all"
  ]
}
```

**Возможные параметры тела запроса**:

| **имя поля**   | **тип**    | **описание**                                                               |
|----------------|------------|----------------------------------------------------------------------------|
| `page`         |            | текущая страница для отображения                                           | 
| `pagesize`     |            | кол-во элементов на странице для отображения. По умолчанию pagesize = 100  |
| `usid`         | `[]uuid`   | список идентификаторов Пользователей                                       |
| `compid`       | `[]uuid`   | список идентификаторов организаций, которым принадлежат Пользователи       |
| `gid`          | `[]string` | список групп Пользователей                                                 |
| `email`        | `[]string` | список почтовых ящиков Пользователей                                       | 
| `country`      | `[]string` | список стран Пользователей                                                 | 
| `org`          | `[]string` | список органиазций Пользователей                                           | 
| `updatedFrom`  | `unixtime` | выдача по времени обновления записи                                        |
| `searchStr`    | `string`   | строка поиска по полям из `search`                                         | 
| `search`       | `[]string` | устанавливает по каким полям делать поиск `searchStr`. Возможные значения: | 
| `-name`        | `opt`      | поиск по имени Пользователя                                                |
| `-email`       | `opt`      | поиск по почте Пользователя                                                | 
| `-country`     | `opt`      | поиск по стране Пользователя                                               |
| `order`        | `[]string` | устанавливает сортировку выдачи списка. Возможные значения в массиве:      | 
| `-compid`      | `opt`      | сортировка по организации, которой принадлежит Пользователь                | 
| `-name`        | `opt`      | сортировка по имени                                                        | 
| `-gid`         | `opt`      | сортировка по группе                                                       | 
| `-email`       | `opt`      | сортировка по почте Пользователя                                           | 
| `-country`     | `opt`      | сортировка по стране Пользователя                                          | 
| `-org`         | `opt`      | сортировка по органиазции Пользователя                                     | 
| `-created`     | `opt`      | сортировка по времени создания                                             | 
| `-updated`     | `opt`      | сортировка по времени обновления                                           | 
| `orderDir`     | `string`   | устанавливает направление сортировки выдачи списка. `asc` или `desc`       | 
| `flag `        | `[]string` | массив флагов. Значения:                                                   | 
| `-all`         | `opt`      | отображать активные записи + архивные                                      |
| `-archiveonly` | `opt`      | отобразить только архивные записи                                          |

**Пример:**
`/api/v1/users/list`

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "users": {
      "info": {
        "page": 0,
        "pagecount": 1,
        "pagesize": 100,
        "total": 3
      },
      "items": [
        {
          "usid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
          "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
          "gid": "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
          "name": "SimpleUser",
          "email": "demo@example.com",
          "country": "Russia",
          "org": "MeteoContext",
          "data": {
            "def": "Описание пользователя"
          },
          "created": 1531398947,
          "updated": 76597656795,
          "archived": 1505299738
        },
        {
          "usid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
          "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
          "gid": "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
          "name": "SimpleUser",
          "email": "demo@example.com",
          "country": "Russia",
          "org": "MeteoContext",
          "data": {
            "def": "Описание пользователя"
          },
          "created": 1531398947,
          "updated": 76597656795,
          "archived": 1505299738
        }
      ]
    }
  }
}

```

**Возможные поля ответа:**

| **имя поля** | **тип**       | **описание**                                                        |
|--------------|---------------|---------------------------------------------------------------------|
| `page`       | `string`      | текущий номер страницы (дублирует параметр запроса)                 |
| `pagecount`  | `string`      | общее число страниц (зависит от размера pagesize)                   |
| `pagesize`   | `string`      | сколько элементов выдавать на странице (дублирует параметр запроса) |
| `total`      | `string`      | всего элементов в таблице                                           |
| `usid`       | `uuid`        | уникальный идентификатор Пользователя                               |
| `compid`     | `uuid`        | идентификатор организации, которой принадлежит Пользователь         |
| `gid`        | `integer`     | группа Пользователи - ее идентификатор                              |
| `name`       | `string[255]` | наименование Пользователя (никнейм)                                 |
| `email`      | `string[255]` | почта Пользователя                                                  |
| `country`    | `string[255]` | страна Пользователя                                                 |
| `org`        | `string[255]` | организация Пользователя                                            |
| `data`       | `json`        | данные Пользователя                                                 |

## 2. Информация по указанному Пользователю

**Назначение:** для получения информации по указанному Пользователю.

**Запрос** `/api/v1/users/USID_ID`
где `USID_ID` – идентификатор Пользователя

**Тип запроса:** GET

**Возможные параметры:**  нет

**Пример:**  `/api/v1/users/dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "user": {
      "usid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
      "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
      "allowcomp": [
        "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "c2caaa-ed42-11ce-bacd-00aa0057b111"
      ],
      "gid": "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
      "name": "SimpleUser",
      "email": "demo@example.com",
      "country": "Russia",
      "org": "MeteoContext",
      "data": {
        "def": "Описание пользователя"
      },
      "group.body": {
        "roles": [
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
        ],
        "datasets": [
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
        ],
        "levels": [
          "b0e3e102-8bf5-11ec-88f9-02420a000dc5",
          "b0e3e103-8bf5-11ec-88f9-02420a000dc5",
          "b0e3e104-8bf5-11ec-88f9-02420a000dc5"
        ]
      },
      "body": {
        "roles": [
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
        ],
        "datasets": [
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
          "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
        ],
        "levels": [
          "b0e3e102-8bf5-11ec-88f9-02420a000dc5",
          "b0e3e103-8bf5-11ec-88f9-02420a000dc5",
          "b0e3e104-8bf5-11ec-88f9-02420a000dc5"
        ]
      },
      "created": 1531398947,
      "updated": 76597656795,
      "archived": 1505299738
    }
  }
}

```

**Возможные поля ответа:**

| **имя поля** | **тип**       | **описание**                                                |
|--------------|---------------|-------------------------------------------------------------|
| `usid`       | `uuid`        | уникальный идентификатор Пользователя                       |
| `compid`     | `uuid`        | идентификатор организации, которой принадлежит Пользователь |
| `allowcomp`  | `[]uuid`      | массив организаций, к которым имеет доступ Пользователь     |
| `roles`      | `[]uuid`      | массив ролей присвоенных Пользователю                       |
| `levels`     | `[]uuid`      | массив уровней доступа к данным присвоенных Пользователю    |
| `datasets`   | `[]uuid`      | массив датасетов доступных  Пользователю                    |
| `gid`        | `integer`     | группа Пользователи - ее идентификатор                      |
| `name`       | `string[255]` | наименование Пользователя (никнейм)                         |
| `email`      | `string[255]` | почта Пользователя                                          |
| `country`    | `string[255]` | страна Пользователя                                         |
| `org`        | `string[255]` | организация Пользователя                                    |
| `data`       | `json`        | данные Пользователя                                         |
| `body`       | `json`        | расширенные данные Пользователя                             |
| `group.body` | `json`        | расширенные данные Группы Пользователя                      |

## 3. Создать новую запись о Пользователе

**Назначение:** для регистрации нового Пользователя

После регистрации пользователя он должен подтвердить свой адрес электройнной почты.

В случае создания пользователя с флагом `confirmed=true` пользователь создается с подтверженной почтой

**Запрос** `/api/v1/users/new`

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                               |
|--------------|---------|--------------------------------------------|
| `confirmed`  | `bool`  | флаг создания подтвержденного пользователя |

**Пример:**  `/api/v1/users/new?confirmed=true`

Передаваемые данные:

```json

{
  "usid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
  "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
  "gid": "6016ebf8-81a3-11e7-bb31-be2e44b06b34",
  "name": "SimpleUser",
  "email": "demo@example.com",
  "pass": "MyPassword",
  "country": "Russia",
  "org": "MeteoContext",
  "data": {
    "def": "Описание пользователя"
  },
  "body": {
    "roles": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "datasets": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "levels": [
      "b0e3e102-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e103-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e104-8bf5-11ec-88f9-02420a000dc5"
    ]
  }
}
```

**Ответ:**

```json

{
  "meta": {},
  "response": {
    "user": {
      "usid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
    }
  }
}

``` 

**Обязательные параметры:**

| **имя поля** | **тип**       | **описание**                                                |
|--------------|---------------|-------------------------------------------------------------|
| `compid`     | `uuid`        | идентификатор организации, которой принадлежит Пользователь |
| `email`      | `string[255]` | почта Пользователя                                          |
| `pass`       | `string[255]` | пароль Пользователя                                         |
| `data`       | `json`        | данные Пользователя                                         |
| `body`       | `json`        | расширенные данные Пользователя                             |
| `roles`      | `[]uuid`      | массив ролей присвоенных Пользователю                       |
| `levels`     | `[]uuid`      | массив уровней доступа к данным присвоенных Пользователю    |
| `datasets`   | `[]uuid`      | массив датасетов доступных  Пользователю                    |

**Необязательные параметры:**

| **имя поля** | **тип**       | **описание**                          |
|--------------|---------------|---------------------------------------|
| `usid`       | `uuid`        | уникальный идентификатор Пользователя |
| `gid`        | `integer`     | группа Пользователя                   |
| `name`       | `string[255]` | наименование Пользователя (никнейм)   |
| `country`    | `string[255]` | страна Пользователя                   |
| `org`        | `string[255]` | организация Пользователя              |

Если при создании Пользователи не указывается `name` то он должен устанаваливаться в значение `email`

**Поля ответа:**

| **имя поля** | **тип** | **описание**                          |
|--------------|---------|---------------------------------------|
| `usid`       | uuid    | уникальный идентификатор Пользователя |

## 4. Обновить информацию об Пользователи

**Назначение:** для обновления информации об Пользователи. Обновляются указанные в запросе поля.

Невозможно обновить поля `usid`, `compid`, `gid`

**Запрос** `/api/v1/users/USID_ID/update`
где `USID_ID` – идентификатор Пользователя

**Тип запроса:** POST

**Пример:**  `/api/v1/users/dea50f0c-f55f-4063-9f17-e45ae8c03bce/update`

Передаваемые данные:

```json

{
  "name": "SimpleUser",
  "email": "demo@example.com",
  "pass": "MyPassword",
  "country": "Russia",
  "org": "MeteoContext",
  "data": {
    "def": "Описание пользователя"
  },
  "body": {
    "roles": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "datasets": [
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff11",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff12",
      "c2caaaaa-ed42-11ce-bacd-00aa0057ff13"
    ],
    "levels": [
      "b0e3e102-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e103-8bf5-11ec-88f9-02420a000dc5",
      "b0e3e104-8bf5-11ec-88f9-02420a000dc5"
    ]
  }
}
```

**Ответ:**

```json

{}

```

**Возможные поля запроса:**

| **имя поля** | **тип**       | **описание**                                             |
|--------------|---------------|----------------------------------------------------------|
| `email`      | `string[255]` | почта Пользователя                                       |
| `pass`       | `string[255]` | пароль Пользователя                                      |
| `name`       | `string[255]` | наименование Пользователя (никнейм)                      |
| `country`    | `string[255]` | страна Пользователя                                      |
| `org`        | `string[255]` | организация Пользователя                                 |
| `data`       | `json`        | данные Пользователя                                      |
| `body`       | `json`        | расширенные данные Пользователя                          |
| `roles`      | `[]uuid`      | массив ролей присвоенных Пользователю                    |
| `levels`     | `[]uuid`      | массив уровней доступа к данным присвоенных Пользователю |
| `datasets`   | `[]uuid`      | массив датасетов доступных  Пользователю                 |

## 5. Архивировать запись о Пользователе

**Назначение:** для архивации записи о Пользователе

**Запрос** `/api/v1/users/archive?usid=USID_ID`
где `USID_ID` – идентификатор Пользователя

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                          |
|--------------|---------|---------------------------------------|
| `usid`       | `uuid`  | уникальный идентификатор Пользователя |

**Пример:**  `/api/v1/users/archive?usid=dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{}

```

## 6. Восстановить запись о Пользователе

**Назначение:** для восстановления ранее архивированной записи о Пользователе

**Запрос** `/api/v1/users/restore?usid=USID_ID`
где `USID_ID` – идентификатор Пользователя

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                          |
|--------------|---------|---------------------------------------|
| `usid`       | `uuid`  | уникальный идентификатор Пользователя |

**Пример:**  `/api/v1/users/restore?usid=dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{}

```

## 7. Удалить запись о Пользователе

**Назначение:** для удаления ранее архивированной записи ое Пользователе

**Запрос** `/api/v1/users/rem?usid=USID_ID`
где `USID_ID` – идентификатор Пользователя

**Тип запроса:** POST

**Параметры запроса:**

| **имя поля** | **тип** | **описание**                          |
|--------------|---------|---------------------------------------|
| `usid`       | `uuid`  | уникальный идентификатор Пользователя |

**Пример:**  `/api/v1/users/rem?usid=dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{}

```
