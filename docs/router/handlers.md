# **Ресурс "Обработчики" (handlers)**

Ресурс **Обработчики** предназначен для управления обработчиками системы.

Обработчик представляет собой связку Сервис + Линк обработки данных

**Список запросов API:**

Каждый Обработчик имеет следующие поля:

* `hid` - уникальный идентификатор записи о Обработчике
* `compid` - идентификатор организации, к которой относится Обработчик
* `depid` - идентификатор подразделения организации, к которой относится Обработчик
* `name` - уникальное наименовние Обработчика (строка без проблелов и с правилами именования файлов )
* `caption` - текстовое представление Обработчика

Каждый Обработчик должен быть при создании привязан к тому или иному компоненту системы через поле `compid`

**Запросы**

## 1. Список Обработчиков

**Назначение:** для получения списка зарегистрированных в системе Обработчиков.

**Запрос** `/api/v2/handlers/list`

**Тип запроса:** GET

**Параметры**:

**Возможные параметры**:

| **имя поля** | **тип**    | **описание**                                                               |
|--------------|------------|----------------------------------------------------------------------------|
| `page`       |            | текущая страница для отображения                                           | 
| `pagesize`   |            | кол-во элементов на странице для отображения. По умолчанию pagesize = 100  |
| `compid`     | `[]uuid`   | список идентификаторов организаций, которым принадлежат Обработчик         |
| `depid`      | `[]uuid`   | список идентификаторов подразделений, которым принадлежат Обработчик       |
| `hid`        | `[]uuid`   | список идентификаторов Обработчиков                                        |
| `name`       | `[]string` | список уникальных имен Обработчиков                                        |
| `svcid`      | `[]string` | список сервисов к которым привязаны Обработчики                            |
| `lid`        | `[]uuid`   | список линков к которым привязаны Обработчики                              |
| `searchStr`  | `string`   | строка поиска по полям из `searchBy`                                       | 
| `searchBy`   | `[]string` | устанавливает по каким полям делать поиск `searchStr`. Возможные значения: | 
| `-name`      | `opt`      | поиск по имени Обработчика                                                 | 
| `-caption`   | `opt`      | поиск по заголовку Обработчика                                             | 
| `order`      | `[]string` | устанавливает сортировку выдачи списка. Возможные значения в массиве:      | 
| `-hid`       | `opt`      | сортировка по идентификаторам,                                             | 
| `-comp`      | `opt`      | сортировка по организации, которой принадлежит Обработчик                  | 
| `-dep`       | `opt`      | сортировка по подразделению, которой принадлежит Обработчик                | 
| `-name`      | `opt`      | сортировка по имени                                                        | 
| `-caption`   | `opt`      | сортировка по заголовку                                                    | 
| `-created`   | `opt`      | сортировка по времени создания                                             | 
| `-updated`   | `opt`      | сортировка по времени обновления                                           | 
| `orderDir`   | `string`   | устанавливает направление сортировки выдачи списка. `asc` или `desc`       | 

**Примеры:**

`/api/v2/handlers/list`

**Ответ:**

```json

{
  "response": {
      "info": {
      "page": 0,
      "pagecount": 1,
      "pagesize": 100,
      "total": 3
    },
    "handlers": [
      {
        "hid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "depid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "name": "srv1",
        "caption": "Обработчик для связи1",
        "service": {
          "svcid": "prsstip"
        },
        "link": {
          "lid": "c2caaa-ed42-11ce-bacd-00aa0057b111"
        },
        "created": 1531398947,
        "updated": 1508912345
      },
      {
        "hid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "depid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
        "name": "srv2",
        "caption": "Обработчик для связи2",
        "service": {
          "svcid": "mapbase"
        },
        "link": {
          "lid": "c2caaa-ed42-11ce-bacd-00aa0057b111"
        },
        "created": 1531398947,
        "updated": 1508912345
      }
    ]
  }
}

```

**Возможные поля ответа:**

| **имя поля**    | **тип**       | ** описание**                                                       |
|-----------------|---------------|---------------------------------------------------------------------|
| `page`          | `string`      | текущий номер страницы (дублирует параметр запроса)                 |
| `pagecount`     | `string`      | общее число страниц (зависит от размера pagesize)                   |
| `pagesize`      | `string`      | сколько элементов выдавать на странице (дублирует параметр запроса) |
| `total`         | `string`      | всего элементов в таблице                                           |
| `hid`           | `uuid`        | уникальный идентификатор Обработчика                                |
| `name`          | `string[255]` | уникальное наименование Обработчика                                 |
| `caption`       | `string[255]` | заголовок Обработчика                                               |
| `compid`        | `uuid`        | идентификатор организации, которой принадлежит Обработчик           |
| `depid`         | `uuid`        | идентификатор подразделения, которому принадлежит Обработчик        |
| `service`       | `json`        | информация о сервисе, к которой привязан Обработчик                 |
| `service.svcid` | `string`        | идентификатор сервиса к которой привязан Обработчик                 |
| `link`          | `json`        | информация о линке, к которой привязан Обработчик                   |
| `link.lid`      | `uuid`        | идентификатор линка к которой привязан Обработчик                   |

## 2. Информация по указанному Обработчику

**Назначение:** для получения информации по указанному Обработчику

**Запрос** `/api/v2/handlers/:hid`

где `:hid` – идентификатор Обработчика

**Тип запроса:** GET

**Возможные параметры:**  нет

**Пример:**  `/api/v2/handlers/dea50f0c-f55f-4063-9f17-e45ae8c03bce`

**Ответ:**

```json

{
  "response": {
    "handler": {
      "hid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
      "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
      "depid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
      "name": "srv1",
      "caption": "Обработчик для связи1",
      "service": {
        "svcid": "mapbase"
      },
      "link": {
        "lid": "c2caaa-ed42-11ce-bacd-00aa0057b111"
      },
      "data": {},
      "created": 1531398947,
      "updated": 1508912345
    }
  }
}
```

**Возможные поля ответа:**

| **имя поля**    | **тип**       | **описание**                                                 |
|-----------------|---------------|--------------------------------------------------------------|
| `hid`           | `uuid`        | уникальный идентификатор Обработчика                         |
| `name`          | `string[255]` | уникальное наименование Обработчика                          |
| `caption`       | `string[255]` | заголовок Обработчика                                        |
| `compid`        | `uuid`        | идентификатор организации, которой принадлежит Обработчик    |
| `depid`         | `uuid`        | идентификатор подразделения, которому принадлежит Обработчик |
| `service`       | `json`        | информация о сервису, к которой привязан Обработчик          |
| `service.svcid` | `string`      | идентификатор сервису к которой привязан Обработчик          |
| `link`          | `json`        | информация о линке, к которой привязан Обработчик            |
| `link.lid`      | `uuid`        | идентификатор линка к которой привязан Обработчик            |
| `data`          | `json`        | данные Обработчика                                           |

## 3. Создать новую запись о Обработчике

**Назначение:** для регистрации нового Обработчика.

**Запрос** `/api/v2/handlers/new`

**Тип запроса:** POST

**Пример:**  `/api/v2/handlers/new`

Передаваемые данные:

```json

{
  "hid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
  "compid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
  "depid": "c2caaa-ed42-11ce-bacd-00aa0057b111",
  "name": "srv1",
  "caption": "Обработчик для связи1",
  "service": {
    "svcid": "mapbase"
  },
  "link": {
    "lid": "c2caaa-ed42-11ce-bacd-00aa0057b111"
  },
  "data": {}
}

```

**Ответ:**

```json

{
  "hid": "dea50f0c-f55f-4063-9f17-e45ae8c03bce"
}

``` 

**Обязательные параметры:**

| **имя поля** | **тип**       | **описание**                                                 |
|--------------|---------------|--------------------------------------------------------------|
| `name`       | `string[255]` | уникальное имя Обработчика                                   |
| `service`    | `json`        | параметры сервису, к которой будет привязан Обработчик       |
| `compid`     | `uuid`        | идентификатор органиазции к которому привязан Обработчик     |
| `depid`      | `uuid`        | идентификатор подразделения, которому принадлежит Обработчик |

**Необязательные параметры:**

| **имя поля** | **тип**  | **описание**                                         |
|--------------|----------|------------------------------------------------------|
| `hid`        | `uuid`   | уникальный идентификатор Обработчика                 |
| `link`       | `json`   | параметры линка, к которой будет привязан Обработчик |
| `caption`    | `string` | заголовок Обработчика                                |
| `data`       | `json`   | параметры Обработчика                                |

Если при создании Обработчика не указывается `caption` то он должен устанаваливаться в значение `name`

**Поля ответа:**

| **имя поля** | **тип** | **описание**                         |
|--------------|---------|--------------------------------------|
| `hid`        | uuid    | уникальный идентификатор Обработчика |

## 5. Обновить информацию об Обработчике

**Назначение:** для обновления информации об Обработчике. Обновляются указанные в запросе поля.

Невозможно обновить поля `compid`, `depid`, `name`, `link`, `service`

**Запрос** `/api/v2/handlers/:hid/update`

где `:hid` – идентификатор Обработчика

**Тип запроса:** POST

**Пример:**  `/api/v2/handlers/dea50f0c-f55f-4063-9f17-e45ae8c03bce/update`

Передаваемые данные:

```json

{
  "caption": "Обработчик для связи1",
  "data": {}
}
```

**Ответ:**

```json

{}

```

**Возможные поля запроса:**

| **имя поля** | **тип**       | **описание**          |
|--------------|---------------|-----------------------|
| `caption`    | `string[255]` | заголок  Обработчика  |
| `data`       | `json`        | параметры Обработчика |

## 8. Удалить запись о Обработчике

**Назначение:** для удаления записи о Обработчике

**Запрос** `/api/v2/handlers/:hid/remove`

где `:hid` – идентификатор Обработчика

**Тип запроса:** POST

**Пример:**  `/api/v2/handlers/dea50f0c-f55f-4063-9f17-e45ae8c03bce/remove

**Ответ:**

```json

{}

```
